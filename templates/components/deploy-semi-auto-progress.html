{% extends "base.html" %}

{% block title %}å…¨è‡ªåŠ¨Hadoopéƒ¨ç½² - Hadoopéƒ¨ç½²ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="deploy-page-wrapper">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-xl-10 col-lg-11">
                <!-- é¡µé¢å¤´éƒ¨ -->
                <div class="page-header mb-4">
                    <div class="header-content">
                        <div class="header-left">
                            <h1 class="page-title">
                                <i class="bi bi-rocket-takeoff"></i>
                                åŠè‡ªåŠ¨Hadoopé›†ç¾¤éƒ¨ç½²
                            </h1>
                            <p class="page-subtitle">ä¸€é”®éƒ¨ç½²ï¼Œæ™ºèƒ½é…ç½®ï¼Œè®©Hadoopé›†ç¾¤éƒ¨ç½²å˜å¾—ç®€å•é«˜æ•ˆ</p>
                </div>
                        <div class="header-right">
                            <button class="btn btn-gradient-primary" id="btnConfigYum" onclick="showConfigYumModal()">
                                <i class="bi bi-gear-fill"></i>
                                <span>é…ç½®yumæº</span>
                            </button>
                    </div>
                            </div>
                            </div>

                <!-- ä¸»å†…å®¹åŒºåŸŸ -->
                <div class="main-content">
                    <!-- ä¿¡æ¯æç¤ºå¡ç‰‡ -->
                    <div class="info-card mb-4">
                        <div class="info-icon">
                            <i class="bi bi-lightbulb-fill"></i>
                        </div>
                        <div class="info-content">
                            <h6 class="info-title">åŠè‡ªåŠ¨éƒ¨ç½²æ¨¡å¼</h6>
                            <p class="info-text">ç³»ç»Ÿå°†å®Œæˆæ‰€æœ‰é…ç½®æ­¥éª¤ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ£€æµ‹ã€Javaå®‰è£…ã€Hadoopä¸‹è½½é…ç½®ç­‰ã€‚è¯·ç¡®ä¿æœåŠ¡å™¨å·²é…ç½®yumæºã€‚</p>
                        </div>
                    </div>

                    <!-- éƒ¨ç½²è¿›åº¦åŒºåŸŸ -->
                    <div class="progress-section mb-4">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-bar-chart-steps"></i>
                                éƒ¨ç½²è¿›åº¦
                            </h5>
                        </div>
                        <div class="progress-container">
                            <div class="progress-wrapper">
                                <div class="progress-bar-custom" id="progressBar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                    <div class="progress-text">0%</div>
                    </div>
                            </div>
                            <div class="progress-status">
                                <span id="progressText" class="status-text">å‡†å¤‡å¼€å§‹éƒ¨ç½²...</span>
                            </div>
                        </div>
                    </div>
                    <!-- éƒ¨ç½²æ­¥éª¤ -->
                    <div id="deploySteps" class="mb-4">
                        <div class="steps-header mb-4">
                            <h5 class="fw-bold mb-2">
                                <i class="bi bi-list-ol me-2 text-primary"></i>éƒ¨ç½²æ­¥éª¤
                            </h5>
                            <p class="text-muted mb-0">ç³»ç»Ÿå°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹7ä¸ªæ­¥éª¤ï¼Œè¯·è€å¿ƒç­‰å¾…</p>
                                </div>
                        <div class="steps-container">
                            <div class="steps-row">
                                <div class="step-card" id="step1">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-search"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                            </div>
                                </div>
                                        <p class="step-description">ç¯å¢ƒæ£€æµ‹</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                            </div>
                                </div>
                            </div>
                                
                                <div class="step-card" id="step2">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-cup-hot"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                                </div>
                            </div>
                                        <p class="step-description">å®‰è£…Java</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                                </div>
                            </div>
                                </div>
                                
                                <div class="step-card" id="step3">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-download"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                            </div>
                        </div>
                                        <p class="step-description">ä¸‹è½½Hadoop</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                    </div>
                        </div>
                    </div>

                                <div class="step-card" id="step4">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-file-earmark-text"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                                            </div>
                                        </div>
                                        <p class="step-description">é…ç½®Hadoop</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="step-card" id="step5">
                                  <div class="step-number">5</div>
                                  <div class="step-content">
                                      <div class="step-header">
                                          <h6 class="step-title">
                                              <i class="bi bi-gear-fill"></i>
                                          </h6>
                                          <div class="step-status">
                                              <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                                          </div>
                                      </div>
                                      <p class="step-description">å®‰è£…ç»„ä»¶</p>
                                      <div class="step-progress">
                                          <div class="progress-line"></div>
                                      </div>
                                  </div>
                              </div>
                                
                                <div class="step-card" id="step6">
                                    <div class="step-number">6</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-play-fill"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                                            </div>
                                        </div>
                                        <p class="step-description">å¯åŠ¨é›†ç¾¤</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="step-card" id="step7">
                                    <div class="step-number">7</div>
                                    <div class="step-content">
                                        <div class="step-header">
                                            <h6 class="step-title">
                                                <i class="bi bi-patch-check-fill"></i>
                                            </h6>
                                            <div class="step-status">
                                                <span class="status-badge status-pending">ç­‰å¾…ä¸­</span>
                                            </div>
                                        </div>
                                        <p class="step-description">éªŒè¯éƒ¨ç½²</p>
                                        <div class="step-progress">
                                            <div class="progress-line"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- éƒ¨ç½²æ—¥å¿—åŒºåŸŸ -->
                    <div class="logs-section mb-4">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-terminal"></i>
                                å®æ—¶éƒ¨ç½²æ—¥å¿—
                            </h5>
                            <div class="log-controls">
                                <button class="btn btn-sm btn-outline-secondary clear-logs-btn" onclick="clearLogs()" title="æ¸…ç©ºæ‰€æœ‰æ—¥å¿—">
                                    <i class="bi bi-trash"></i>
                                    æ¸…ç©ºæ—¥å¿—
                                </button>
                            </div>
                        </div>
                        <div class="log-container">
                            <div class="log-terminal">
                                <div class="terminal-header">
                                    <div class="terminal-buttons">
                                        <span class="terminal-btn terminal-btn-close"></span>
                                        <span class="terminal-btn terminal-btn-minimize"></span>
                                        <span class="terminal-btn terminal-btn-maximize"></span>
                                    </div>
                                    <div class="terminal-title">Hadoop Deploy Terminal</div>
                                </div>
                                <div class="terminal-body">
                                    <pre id="logContent" class="log-content">ç­‰å¾…å¼€å§‹éƒ¨ç½²...</pre>
                                </div>
                            </div>
                        </div>
                        <div id="clusterLinks" class="mt-3"></div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
                    <div class="action-section">
                        <div class="action-buttons">
                            <button class="btn btn-outline-secondary btn-action" onclick="goBack()">
                                <i class="bi bi-arrow-left"></i>
                                <span>è¿”å›ä¸Šä¸€æ­¥</span>
                        </button>
                            <button class="btn btn-gradient-success btn-action" id="startDeploy" onclick="startAutoDeploy()">
                                <i class="bi bi-rocket-takeoff"></i>
                                <span>å¼€å§‹è‡ªåŠ¨éƒ¨ç½²</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- é…ç½®yumæºå¼¹çª— -->
<div class="modal fade" id="yumModal" tabindex="-1" aria-labelledby="yumModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content yum-modal">
      <div class="modal-header">
        <div class="modal-title-wrapper">
          <div class="modal-icon">
            <i class="bi bi-gear-fill"></i>
          </div>
          <div>
            <h5 class="modal-title" id="yumModalLabel">é…ç½®YUMæº</h5>
            <p class="modal-subtitle">æ‰¹é‡é…ç½®æ‰€æœ‰æœåŠ¡å™¨çš„YUMæº</p>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="å…³é—­"></button>
      </div>
      <div class="modal-body">
        <div class="yum-info-card">
          <div class="yum-info-icon">
            <i class="bi bi-info-circle-fill"></i>
          </div>
          <div class="yum-info-content">
            <h6>è‡ªåŠ¨æ‰¹é‡æ“ä½œ</h6>
            <p>ç³»ç»Ÿå°†è‡ªåŠ¨å¯¹æ‰€æœ‰å·²é…ç½®çš„æœåŠ¡å™¨è¿›è¡ŒYUMæºé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥æœåŠ¡å™¨ä¿¡æ¯ã€‚</p>
          </div>
        </div>
        <div id="yumProgressArea" class="yum-progress-area"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle me-2"></i>å–æ¶ˆ
        </button>
        <button type="button" class="btn btn-gradient-primary" onclick="configYumRepo()">
          <i class="bi bi-check-circle me-2"></i>å¼€å§‹é…ç½®
        </button>
      </div>
    </div>
  </div>
</div>
<style>
/* å…¨å±€é¡µé¢æ ·å¼ */
.deploy-page-wrapper {
  min-height: 100vh;
  padding: 2rem 0;
}

/* é¡µé¢å¤´éƒ¨æ ·å¼ */
.page-header {
  margin-bottom: 2rem;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.page-title {
  color: #2c3e50;
  font-size: 2.2rem;
  font-weight: 700;
  margin: 0 0 0.5rem 0;
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.page-title i {
  color: #667eea;
  font-size: 2rem;
}

.page-subtitle {
  color: #6c757d;
  font-size: 1.1rem;
  margin: 0;
  font-weight: 400;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main-content {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

/* ä¿¡æ¯æç¤ºå¡ç‰‡ */
.info-card {
  display: flex;
  align-items: flex-start;
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  border: 1px solid #90caf9;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 20px rgba(33, 150, 243, 0.15);
}

.info-icon {
  background: linear-gradient(135deg, #2196f3, #1976d2);
  color: white;
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  flex-shrink: 0;
}

.info-icon i {
  font-size: 1.3rem;
}

.info-content {
  flex: 1;
}

.info-title {
  color: #1565c0;
  font-weight: 600;
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
}

.info-text {
  color: #0d47a1;
  margin: 0;
  line-height: 1.6;
  font-size: 0.95rem;
}

/* åŒºåŸŸæ ‡é¢˜æ ·å¼ */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid #f8f9fa;
}

.section-title {
  color: #2c3e50;
  font-weight: 600;
  font-size: 1.3rem;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-title i {
  color: #667eea;
}

/* è¿›åº¦æ¡æ ·å¼ */
.progress-container {
  background: #f8f9fa;
  border-radius: 1rem;
  padding: 1.5rem;
  border: 1px solid #e9ecef;
}

.progress-wrapper {
  margin-bottom: 1rem;
}

.progress-bar-custom {
  position: relative;
  height: 2rem;
  background: #e9ecef;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #667eea, #764ba2);
  border-radius: 1rem;
  transition: width 0.5s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: shimmer 2s infinite;
}

.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-weight: 600;
  font-size: 0.9rem;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.progress-status {
  text-align: center;
}

.status-text {
  color: #6c757d;
  font-size: 0.95rem;
  font-weight: 500;
}

/* æ—¥å¿—ç»ˆç«¯æ ·å¼ */
.log-container {
  background: #1e1e1e;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border: 1px solid #333;
}

.terminal-header {
  background: #2d2d2d;
  padding: 0.8rem 1rem;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #444;
}

.terminal-buttons {
  display: flex;
  gap: 0.5rem;
  margin-right: 1rem;
}

.terminal-btn {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  cursor: pointer;
}

.terminal-btn-close {
  background: #ff5f56;
}

.terminal-btn-minimize {
  background: #ffbd2e;
}

.terminal-btn-maximize {
  background: #27ca3f;
}

.terminal-title {
  color: #ccc;
  font-size: 0.9rem;
  font-weight: 500;
}

.terminal-body {
  padding: 1rem;
  max-height: 300px;
  overflow-y: auto;
}

.log-content {
  background: transparent;
  color: #e6eaf3;
  font-family: 'JetBrains Mono', 'Fira Mono', 'Consolas', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
  margin: 0;
  white-space: pre-wrap;
  word-break: break-word;
}

.terminal-body::-webkit-scrollbar {
  width: 8px;
}

.terminal-body::-webkit-scrollbar-track {
  background: #1e1e1e;
}

.terminal-body::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 4px;
}

.terminal-body::-webkit-scrollbar-thumb:hover {
  background: #777;
}

/* æ¸…ç©ºæ—¥å¿—æŒ‰é’®æ ·å¼ */
.clear-logs-btn {
  border-color: #dc3545;
  color: #dc3545;
  background: transparent;
}

.clear-logs-btn:hover {
  background: #dc3545;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
}

.clear-logs-btn:active {
  transform: translateY(0);
}

/* æ“ä½œæŒ‰é’®æ ·å¼ */
.action-section {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 2px solid #f8f9fa;
}

.action-buttons {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
}

.btn-action {
  padding: 1rem 2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  border: none;
  min-width: 160px;
  justify-content: center;
}

.btn-gradient-primary {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
}

.btn-gradient-primary:hover {
  background: linear-gradient(135deg, #5a6fd8, #6a4190);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-gradient-success {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  border: none;
}

.btn-gradient-success:hover {
  background: linear-gradient(135deg, #218838, #1e7e34);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
}

.btn-outline-secondary {
  border: 2px solid #6c757d;
  color: #6c757d;
  background: transparent;
}

.btn-outline-secondary:hover {
  background: #6c757d;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .deploy-page-wrapper {
    padding: 1rem 0;
  }
  
  .header-content {
    flex-direction: column;
    text-align: center;
    gap: 1rem;
    padding: 1.5rem;
  }
  
  .page-title {
    font-size: 1.8rem;
  }
  
  .main-content {
    padding: 1.5rem;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .btn-action {
    width: 100%;
  }
  
  .info-card {
    flex-direction: column;
    text-align: center;
  }
  
  .info-icon {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .steps-row {
    gap: 0.5rem;
  }
  
  .step-card {
    min-width: 120px;
    max-width: 130px;
    padding: 1rem 0.8rem;
  }
  
  .step-number {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  
  .step-title i {
    font-size: 1.1rem;
  }
  
  .step-description {
    font-size: 0.8rem;
  }
  
  .status-badge {
    padding: 0.2rem 0.4rem;
    font-size: 0.65rem;
  }
}

/* YUMé…ç½®å¼¹çª—æ ·å¼ */
.yum-modal {
  border-radius: 1.5rem;
  border: none;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
}

.yum-modal .modal-header {
  border-bottom: 2px solid #f8f9fa;
  padding: 1.5rem 2rem;
}

.modal-title-wrapper {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.modal-icon {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.modal-icon i {
  font-size: 1.3rem;
}

.modal-title {
  color: #2c3e50;
  font-weight: 600;
  margin: 0 0 0.3rem 0;
  font-size: 1.3rem;
}

.modal-subtitle {
  color: #6c757d;
  margin: 0;
  font-size: 0.9rem;
}

.yum-modal .modal-body {
  padding: 2rem;
}

.yum-info-card {
  display: flex;
  align-items: flex-start;
  background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
  border: 1px solid #c3e6cb;
  border-radius: 1rem;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.yum-info-icon {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  flex-shrink: 0;
}

.yum-info-icon i {
  font-size: 1.1rem;
}

.yum-info-content h6 {
  color: #155724;
  font-weight: 600;
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
}

.yum-info-content p {
  color: #0f5132;
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.5;
}

.yum-progress-area {
  min-height: 3rem;
  background: #f8f9fa;
  border-radius: 0.8rem;
  padding: 1rem;
  border: 1px solid #e9ecef;
}

.yum-modal .modal-footer {
  border-top: 2px solid #f8f9fa;
  padding: 1.5rem 2rem;
  gap: 1rem;
}

.yum-modal .btn {
  padding: 0.75rem 1.5rem;
  border-radius: 0.8rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.log-card-simple pre {
  background: transparent !important;
  color: #e6eaf3 !important;
  border: none !important;
  box-shadow: none !important;
  margin-bottom: 0;
  font-size: 1rem;
  letter-spacing: 0.2px;
  line-height: 1.7;
  white-space: pre-wrap;
  word-break: break-all;
}
.log-card-simple::-webkit-scrollbar {
  width: 8px;
  background: #23272e;
}
.log-card-simple::-webkit-scrollbar-thumb {
  background: #3a3f4b;
  border-radius: 4px;
}

/* éƒ¨ç½²æˆåŠŸå¡ç‰‡æ ·å¼ */
.deployment-success-card {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  border: 1px solid #c3e6cb;
  border-radius: 1rem;
  padding: 1.5rem;
  margin-top: 1rem;
  box-shadow: 0 4px 20px rgba(40, 167, 69, 0.15);
  animation: slideInUp 0.6s ease-out;
}

.success-header {
  display: flex;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid rgba(40, 167, 69, 0.2);
}

.success-icon {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.success-icon i {
  font-size: 1.8rem;
}

.success-title h4 {
  color: #155724;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.success-title p {
  color: #0f5132;
  font-size: 0.95rem;
  margin: 0;
}

.links-title {
  color: #155724;
  font-weight: 600;
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.links-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
}

.link-card {
  background: white;
  border-radius: 0.8rem;
  padding: 1.2rem;
  border: 1px solid rgba(40, 167, 69, 0.2);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.link-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #28a745, #20c997);
}

.link-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
  border-color: #28a745;
}

.namenode-card::before {
  background: linear-gradient(90deg, #007bff, #0056b3);
}

.resourcemanager-card::before {
  background: linear-gradient(90deg, #fd7e14, #e55a00);
}

.link-card:hover.namenode-card::before {
  background: linear-gradient(90deg, #0056b3, #004085);
}

.link-card:hover.resourcemanager-card::before {
  background: linear-gradient(90deg, #e55a00, #cc4a00);
}

.link-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1rem;
  font-size: 1.5rem;
  color: white;
}

.namenode-card .link-icon {
  background: linear-gradient(135deg, #007bff, #0056b3);
}

.resourcemanager-card .link-icon {
  background: linear-gradient(135deg, #fd7e14, #e55a00);
}

.link-content {
  flex: 1;
}

.link-title {
  color: #212529;
  font-weight: 600;
  margin-bottom: 0.5rem;
  font-size: 1rem;
}

.link-desc {
  color: #6c757d;
  font-size: 0.9rem;
  margin-bottom: 1rem;
  line-height: 1.4;
}

.link-button {
  display: inline-flex;
  align-items: center;
  padding: 0.6rem 1.2rem;
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  text-decoration: none;
  border-radius: 0.6rem;
  font-weight: 500;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
}

.link-button:hover {
  background: linear-gradient(135deg, #218838, #1e7e34);
  color: white;
  text-decoration: none;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
}

.namenode-card .link-button {
  background: linear-gradient(135deg, #007bff, #0056b3);
}

.namenode-card .link-button:hover {
  background: linear-gradient(135deg, #0056b3, #004085);
}

.resourcemanager-card .link-button {
  background: linear-gradient(135deg, #fd7e14, #e55a00);
}

.resourcemanager-card .link-button:hover {
  background: linear-gradient(135deg, #e55a00, #cc4a00);
}

.success-footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(40, 167, 69, 0.2);
}

.success-tip {
  display: flex;
  align-items: center;
  color: #0f5132;
  font-size: 0.9rem;
  background: rgba(40, 167, 69, 0.1);
  padding: 0.8rem 1rem;
  border-radius: 0.6rem;
  border-left: 4px solid #28a745;
}

.success-tip i {
  color: #28a745;
  font-size: 1rem;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* éƒ¨ç½²æ­¥éª¤æ ·å¼ */
.steps-header {
  text-align: center;
  padding: 1rem 0;
}

.steps-header h5 {
  color: #2c3e50;
  font-size: 1.3rem;
}

.steps-container {
  position: relative;
}

.steps-row {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding: 0.5rem 0;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.steps-row::-webkit-scrollbar {
  display: none;
}

.step-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 140px;
  max-width: 160px;
  padding: 1.2rem 1rem;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
  border: 2px solid #f8f9fa;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
}

.step-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #e9ecef, #dee2e6);
  transition: all 0.3s ease;
}

.step-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.step-number {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: linear-gradient(135deg, #e9ecef, #dee2e6);
  color: #6c757d;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.1rem;
  margin-bottom: 0.8rem;
  flex-shrink: 0;
  transition: all 0.3s ease;
  border: 3px solid #f8f9fa;
}

.step-content {
  width: 100%;
  text-align: center;
}

.step-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 0.6rem;
}

.step-title {
  color: #495057;
  font-weight: 600;
  font-size: 1.2rem;
  margin: 0 0 0.5rem 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.step-title i {
  color: #6c757d;
  font-size: 1.3rem;
}

.step-description {
  color: #6c757d;
  font-size: 0.85rem;
  margin: 0 0 0.8rem 0;
  line-height: 1.3;
  font-weight: 500;
}

.step-progress {
  position: relative;
  height: 4px;
  background: #f8f9fa;
  border-radius: 2px;
  overflow: hidden;
}

.progress-line {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #007bff, #0056b3);
  border-radius: 2px;
  transition: width 0.5s ease;
}

.status-badge {
  padding: 0.3rem 0.6rem;
  border-radius: 0.8rem;
  font-size: 0.7rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

.status-pending {
  background: #f8f9fa;
  color: #6c757d;
  border: 1px solid #dee2e6;
}

.status-doing {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border: 1px solid #007bff;
  animation: pulse 2s infinite;
}

.status-done {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  border: 1px solid #28a745;
}

.status-error {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
  border: 1px solid #dc3545;
}

/* æ­¥éª¤çŠ¶æ€æ ·å¼ */
.step-card.step-pending .step-number {
  background: linear-gradient(135deg, #e9ecef, #dee2e6);
  color: #6c757d;
}

.step-card.step-doing {
  border-color: #007bff;
  box-shadow: 0 4px 20px rgba(0, 123, 255, 0.15);
  transform: scale(1.05);
}

.step-card.step-doing::before {
  background: linear-gradient(90deg, #007bff, #0056b3);
}

.step-card.step-doing .step-number {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border-color: #007bff;
}

.step-card.step-done {
  border-color: #28a745;
  box-shadow: 0 4px 20px rgba(40, 167, 69, 0.15);
}

.step-card.step-done::before {
  background: linear-gradient(90deg, #28a745, #20c997);
}

.step-card.step-done .step-number {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  border-color: #28a745;
}

.step-card.step-error {
  border-color: #dc3545;
  box-shadow: 0 4px 20px rgba(220, 53, 69, 0.15);
}

.step-card.step-error::before {
  background: linear-gradient(90deg, #dc3545, #c82333);
}

.step-card.step-error .step-number {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
  border-color: #dc3545;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
  }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .success-header {
    flex-direction: column;
    text-align: center;
  }
  
  .success-icon {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .links-grid {
    grid-template-columns: 1fr;
  }
  
  .link-card {
    padding: 1rem;
  }
  
  .deployment-success-card {
    padding: 1rem;
  }
  
  .step-card {
    padding: 1rem;
    margin-bottom: 1rem;
  }
  
  .step-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .step-number {
    width: 40px;
    height: 40px;
    font-size: 1rem;
    margin-right: 1rem;
  }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
let deployInProgress = false;
let lastLogLength = 0;

function updateSteps(steps) {
    for (let i = 0; i < steps.length; i++) {
        const stepDiv = document.getElementById('step' + (i + 1));
        if (!stepDiv) continue;
        
        let status = steps[i].status;
        const statusBadge = stepDiv.querySelector('.status-badge');
        const progressLine = stepDiv.querySelector('.progress-line');
        
        // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
        stepDiv.classList.remove('step-pending', 'step-doing', 'step-done', 'step-error');
        if (statusBadge) {
            statusBadge.classList.remove('status-pending', 'status-doing', 'status-done', 'status-error');
        }
        
        if (status === 'pending') {
            if (statusBadge) statusBadge.textContent = 'ç­‰å¾…ä¸­';
            if (statusBadge) statusBadge.classList.add('status-pending');
            stepDiv.classList.add('step-pending');
            if (progressLine) progressLine.style.width = '0%';
        } else if (status === 'doing') {
            if (statusBadge) statusBadge.textContent = 'è¿›è¡Œä¸­';
            if (statusBadge) statusBadge.classList.add('status-doing');
            stepDiv.classList.add('step-doing');
            if (progressLine) progressLine.style.width = '50%';
        } else if (status === 'done') {
            if (statusBadge) statusBadge.textContent = 'å·²å®Œæˆ';
            if (statusBadge) statusBadge.classList.add('status-done');
            stepDiv.classList.add('step-done');
            if (progressLine) progressLine.style.width = '100%';
        } else if (status === 'error') {
            if (statusBadge) statusBadge.textContent = 'å¤±è´¥';
            if (statusBadge) statusBadge.classList.add('status-error');
            stepDiv.classList.add('step-error');
            if (progressLine) progressLine.style.width = '0%';
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // è‡ªåŠ¨ä»URLå‚æ•°å†™å…¥sessionStorageï¼Œå…¼å®¹URLè·³è½¬
    const urlParams = new URLSearchParams(window.location.search);
    const configParam = urlParams.get('config');
    if (configParam) {
        sessionStorage.setItem('serverConfig', configParam);
    }
    // åŸæœ‰æ ¡éªŒé€»è¾‘
    const config = sessionStorage.getItem('serverConfig');
    if (!config) {
        alert('æœªæ‰¾åˆ°æœåŠ¡å™¨é…ç½®ä¿¡æ¯ï¼Œè¯·è¿”å›é‡æ–°é…ç½®');
        window.location.href = '/';
    }
    
    // åˆå§‹åŒ–æ­¥éª¤çŠ¶æ€
    for (let i = 1; i <= 6; i++) {
        const stepDiv = document.getElementById('step' + i);
        if (stepDiv) {
            stepDiv.classList.add('step-pending');
            const statusBadge = stepDiv.querySelector('.status-badge');
            if (statusBadge) {
                statusBadge.classList.add('status-pending');
            }
        }
    }
});

function goBack() {
    window.location.href = '/deploy/method';
}

function startAutoDeploy() {
    // 1. è·å–æœåŠ¡å™¨ä¿¡æ¯
    const servers = JSON.parse(sessionStorage.getItem('serverConfig') || '[]');
    const javaTempPath = sessionStorage.getItem('javaTempPath') || '';
    const hadoopTempPath = sessionStorage.getItem('hadoopTempPath') || '';
    const config = JSON.parse(sessionStorage.getItem('semiAutoConfig') || '{}');
    config.servers = servers;
    config.javaTempPath = javaTempPath;
    config.hadoopTempPath = hadoopTempPath;
    // 5. å‘é€åˆ°åç«¯
    fetch('/api/deploy/semi-auto/start', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ config })
    })
    .then(res => res.json())
    .then(data => {
        if (data.msg) {
            addLog(data.msg);
        }
        pollDeployStatus()
        if (data.success) {
            document.getElementById('progressText').textContent = 'éƒ¨ç½²å·²å¯åŠ¨ï¼Œæ­£åœ¨æ‰§è¡Œ...';
        } else {
            document.getElementById('progressText').textContent = data.msg || data.error || 'éƒ¨ç½²å¯åŠ¨å¤±è´¥';
        }
    })
    .catch((error) => {
        document.getElementById('progressText').textContent = 'è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•';
    });
}

function addLog(message) {
    const logElement = document.getElementById('logContent');
    const timestamp = new Date().toLocaleTimeString();
    logElement.textContent += `[${timestamp}] ${message}\n`;
    logElement.scrollTop = logElement.scrollHeight;
}

function highlightLog(logText) {
    // é«˜äº®[é”™è¯¯]ä¸ºçº¢è‰²ï¼Œå…¶ä½™ä¸å˜
    return logText.replace(/(\[é”™è¯¯\].*)/g, '<span style="color:#d32f2f;font-weight:bold;">$1</span>');
}

function pollDeployStatus() {
    fetch('/api/deploy/semi-auto/status')
        .then(res => res.json())
        .then(data => {
            // æ›´æ–°è¿›åº¦æ¡
            const progressBar = document.getElementById('progressBar');
            const progressFill = progressBar.querySelector('.progress-fill');
            const progressText = progressBar.querySelector('.progress-text');
            const progress = data.progress || 0;
            progressFill.style.width = progress + '%';
            progressText.textContent = progress + '%';
            // æ›´æ–°è¿›åº¦æ–‡æœ¬
            document.getElementById('progressText').innerHTML = data.log && data.log.length > 0 ? data.log[data.log.length - 1] : 'å‡†å¤‡å¼€å§‹éƒ¨ç½²...';
            // æ›´æ–°æ—¥å¿—
            if (data.log) {
                const raw = data.log.map((msg, idx) => `[${idx+1}] ${msg}`).join('\n');
                document.getElementById('logContent').innerHTML = highlightLog(raw);
                document.getElementById('logContent').scrollTop = document.getElementById('logContent').scrollHeight;
            }
            // æ›´æ–°æ­¥éª¤
            if (data.steps) {
                updateSteps(data.steps);
            }
            // éƒ¨ç½²å®Œæˆåæ˜¾ç¤ºé›†ç¾¤é“¾æ¥
            if (data.status === 'done' && data.cluster_links) {
                let html = `
                <div class="deployment-success-card">
                    <div class="success-header">
                        <div class="success-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="success-title">
                            <h4 class="mb-1">ğŸ‰ é›†ç¾¤éƒ¨ç½²æˆåŠŸï¼(ç»„ä»¶å®‰è£…ç›®å½•å‡ä½äº/optç›®å½•ä¸‹)</h4>
                            <p class="mb-0">Hadoopé›†ç¾¤å·²æˆåŠŸå¯åŠ¨ï¼Œæ‚¨ç°åœ¨å¯ä»¥è®¿é—®ä»¥ä¸‹ç®¡ç†ç•Œé¢</p>
                        </div>
                    </div>
                    <div class="cluster-links-container">
                        <h5 class="links-title"><i class="bi bi-link-45deg me-2"></i>Web UI ç®¡ç†å…¥å£</h5>
                        <div class="links-grid">`;
                
                if (data.cluster_links.NameNode) {
                    html += `
                            <div class="link-card namenode-card">
                                <div class="link-icon">
                                    <i class="bi bi-hdd-network"></i>
                                </div>
                                <div class="link-content">
                                    <h6 class="link-title">NameNode ç®¡ç†ç•Œé¢</h6>
                                    <p class="link-desc">HDFSæ–‡ä»¶ç³»ç»Ÿç®¡ç†</p>
                                    <a href="${data.cluster_links.NameNode}" target="_blank" class="link-button">
                                        <i class="bi bi-box-arrow-up-right me-2"></i>è®¿é—®ç•Œé¢
                                    </a>
                                </div>
                            </div>`;
                }
                
                if (data.cluster_links.ResourceManager) {
                    html += `
                            <div class="link-card resourcemanager-card">
                                <div class="link-icon">
                                    <i class="bi bi-cpu"></i>
                                </div>
                                <div class="link-content">
                                    <h6 class="link-title">YARN ResourceManager</h6>
                                    <p class="link-desc">èµ„æºè°ƒåº¦ä¸ç®¡ç†</p>
                                    <a href="${data.cluster_links.ResourceManager}" target="_blank" class="link-button">
                                        <i class="bi bi-box-arrow-up-right me-2"></i>è®¿é—®ç•Œé¢
                                    </a>
                                </div>
                            </div>`;
                }
                
                html += `
                        </div>
                        <div class="success-footer">
                            <div class="success-tip">
                                <i class="bi bi-lightbulb me-2"></i>
                                <span>æç¤ºï¼šç‚¹å‡»é“¾æ¥å°†åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ç®¡ç†ç•Œé¢ï¼ˆè¯·åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œsource ~/.hadoop_envå‘½ä»¤ï¼Œä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼‰</span>
                            </div>
                        </div>
                    </div>
                </div>`;
                
                document.getElementById('clusterLinks').innerHTML = html;
                document.getElementById('startDeploy').innerHTML = '<i class="bi bi-check-circle me-2"></i>éƒ¨ç½²å®Œæˆ';
                document.getElementById('startDeploy').classList.remove('btn-success');
                document.getElementById('startDeploy').classList.add('btn-secondary');
            } else if (data.status === 'error') {
                document.getElementById('startDeploy').innerHTML = '<i class="bi bi-x-circle me-2"></i>éƒ¨ç½²å¤±è´¥';
                document.getElementById('startDeploy').classList.remove('btn-success');
                document.getElementById('startDeploy').classList.add('btn-danger');
            }
            // ç»§ç»­è½®è¯¢
            if (data.status === 'running' || data.status === 'idle') {
                setTimeout(pollDeployStatus, 1500);
            }
        });
}

function showConfigYumModal() {
    var modal = new bootstrap.Modal(document.getElementById('yumModal'));
    modal.show();
}

function configYumRepo() {
    let servers = sessionStorage.getItem('serverConfig');
    try {
        servers = JSON.parse(servers);
    } catch (e) {
        alert('æœåŠ¡å™¨é…ç½®ä¿¡æ¯æ ¼å¼é”™è¯¯');
        return;
    }
    if (!servers || !Array.isArray(servers) || servers.length === 0) {
        alert('æœªæ‰¾åˆ°æœåŠ¡å™¨é…ç½®ä¿¡æ¯');
        return;
    }
    // æ˜¾ç¤ºè¿›åº¦
    const progressArea = document.getElementById('yumProgressArea');
    progressArea.innerHTML = '<div class="text-info"><i class="bi bi-arrow-repeat me-2"></i>æ­£åœ¨æ‰¹é‡é…ç½®yumæºï¼Œè¯·ç¨å€™...</div>';
    fetch('/api/yum/configure', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ servers })
    })
    .then(res => res.json())
    .then(data => {
        if (data.results && Array.isArray(data.results)) {
            let html = '<ul class="list-group">';
            data.results.forEach(r => {
                html += `<li class='list-group-item d-flex justify-content-between align-items-center'>
                    <span>${r.host}</span>
                    <span>${r.success ? '<span class=\'text-success\'>æˆåŠŸ</span>' : '<span class=\'text-danger\'>å¤±è´¥</span>'} ${r.msg ? ('<small class=\'ms-2\'>' + r.msg + '</small>') : ''}</span>
                </li>`;
            });
            html += '</ul>';
            progressArea.innerHTML = html;
        } else {
            progressArea.innerHTML = '<div class="text-danger">æœªè·å–åˆ°æœåŠ¡å™¨è¿”å›ç»“æœ</div>';
        }
        if (data.success) {
            setTimeout(() => {
                var modal = bootstrap.Modal.getInstance(document.getElementById('yumModal'));
                if (modal) modal.hide();
            }, 1800);
        }
    })
    .catch(err => {
        progressArea.innerHTML = '<div class="text-danger">è¯·æ±‚å¤±è´¥: ' + err + '</div>';
    });
}

function clearLogs() {
    // æ˜¾ç¤ºæ¸…ç©ºä¸­çŠ¶æ€
    const logElement = document.getElementById('logContent');
    logElement.textContent = 'ğŸ”„ æ­£åœ¨æ¸…ç©ºæ—¥å¿—...\n';
    logElement.style.color = '#ffc107';
    
    // æ¸…ç©ºæœåŠ¡å™¨ç«¯æ—¥å¿—æ•°ç»„
    fetch('/api/deploy/auto/clear-logs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // æ¸…ç©ºæœ¬åœ°æ—¥å¿—æ˜¾ç¤º
            logElement.textContent = 'âœ… æ—¥å¿—å·²æ¸…ç©º\n';
            logElement.style.color = '#28a745';
            lastLogLength = 0;
            
            // 2ç§’åæ¢å¤é»˜è®¤é¢œè‰²
            setTimeout(() => {
                logElement.style.color = '#e6eaf3';
            }, 2000);
        } else {
            logElement.textContent = 'âŒ æ¸…ç©ºæ—¥å¿—å¤±è´¥\n';
            logElement.style.color = '#dc3545';
            
            // 2ç§’åæ¢å¤é»˜è®¤é¢œè‰²
            setTimeout(() => {
                logElement.style.color = '#e6eaf3';
            }, 2000);
        }
    })
    .catch(err => {
        console.log('æ¸…ç©ºæ—¥å¿—è¯·æ±‚å¤±è´¥:', err);
        logElement.textContent = 'âŒ æ¸…ç©ºæ—¥å¿—å¤±è´¥\n';
        logElement.style.color = '#dc3545';
        
        // 2ç§’åæ¢å¤é»˜è®¤é¢œè‰²
        setTimeout(() => {
            logElement.style.color = '#e6eaf3';
        }, 2000);
    });
}

function fetchLog() {
  fetch('/api/log')
    .then(res => res.text())
    .then(log => {
      const logPre = document.getElementById('logContent');
      
      // å¦‚æœæ—¥å¿—å†…å®¹æ˜¾ç¤ºçš„æ˜¯æ¸…ç©ºçŠ¶æ€ï¼Œåˆ™ä¸æ›´æ–°
      if (logPre.textContent.includes('æ—¥å¿—å·²æ¸…ç©º') || 
          logPre.textContent.includes('æ­£åœ¨æ¸…ç©ºæ—¥å¿—') ||
          logPre.textContent.includes('æ¸…ç©ºæ—¥å¿—å¤±è´¥')) {
        return;
      }
      
      const lines = log.split('\n');
      if (lines.length > lastLogLength) {
        const newLines = lines.slice(lastLogLength).join('\n');
        logPre.innerHTML += (lastLogLength > 0 ? '\n' : '') + highlightLog(newLines);
        lastLogLength = lines.length;
        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        const logCard = logPre.parentElement;
        if (logCard) {
          logCard.scrollTop = logCard.scrollHeight;
        }
      }
    })
    .catch(err => {
      console.log('è·å–æ—¥å¿—å¤±è´¥:', err);
    });
}
setInterval(fetchLog, 2000); // æ¯2ç§’åˆ·æ–°ä¸€æ¬¡
</script>
{% endblock %} 